# キーパッド画面 仕様（最終整理）

参照画像: `docs/specs/keypadUI.png`
本ページは product.md と画像に基づく最終仕様です。UI画像に忠実に実装し、細部は近似で可（グラデ/白枠/影は省略可）。

---

## レイアウト/要素
- 上段: PRESENT TIME（現在時刻）
  - ラベル: YEAR / MON / DAY / HOUR / MIN
  - セグメント風表示で現在値を表示（7セグ風または等幅フォント）
- 中央: 下向き二重矢印（静止でOK）
- 中段: DESTINATION TIME（行き先時刻）
  - YEAR / MON / DAY / HOUR / MIN の5フィールド。未入力は `----` / `--` でプレースホルダ
  - アクティブなフィールドは太い白枠
- 下段: 数字キーパッド（3×4）
  - 1 2 3 / 4 5 6 / 7 8 9 / [左補助] 0 [右削除]
  - 左補助: 小ウィンドウ（プリセット/DatePicker/プリセット作成）を開く
  - 右削除: 1文字削除（バックスペース）。長押し全消去は無し
- 発信ボタン（緑）: 押下時の挙動
  - DESTINATION TIME が入力完了かつバリデーション通過 → `k0.wav` を再生し、録音へ遷移
  - 上記を満たさない → 遷移せず `ke.wav` のみ再生（警告）
- 画面最下部: 5ボタンナビ（左→右）
  - 設定 / ライブラリ（履歴） / キーパッド / 着信予定メールリスト（編集） / 留守電
  - アイコンは類似のプレースホルダーで可（後日差し替え）

---

## 入力仕様
- 入力順: YEAR(4桁) → MON(2) → DAY(2) → HOUR(2) → MIN(2)
- 連続入力で自動的に次フィールドへフォーカス遷移
- 任意フィールドをタップでフォーカス。以降の入力は現値に上書き。所定桁数に満たず別箇所をタップした場合は元値へ戻す
- バックスペース（右ボタン）: 現在フィールドの末尾1桁削除。空になったら前フィールドへ移動し続けて削除
- 左補助（小ウィンドウ）
  - 固定プリセット: 「+1時間」「明日の同時刻」
  - カスタムプリセット一覧（作成/削除可能）
  - DatePicker（直接選択）
  - いずれか選択で DESTINATION TIME に即反映し、バリデーションを通過すれば発信ボタンを有効化

### カスタムプリセット（小ウィンドウ内）
- 作成項目
  - 日数: 明日(1)〜1週間後(7)の整数
  - 時刻: 時・分（HH:mm）
  - 表示名: 任意（未入力時は自動生成「n日後 HH:mm」）
- 保存するとリストに追加（SwiftDataに保持）。削除可能（スワイプ/削除ボタン）

---

## バリデーション
- 未来必須。現在時刻より少なくとも1分後
- 上限は現在から1年以内
- 不正日付は入力不可（うるう年/各月の日数を考慮）
- タイムゾーン/DSTは表示のみローカル、内部はUTC

---

## ハプティクス/演出/サウンド
- ハプティクス: 数字キー/補助/削除/発信いずれも「短いフェードの一瞬明度アップ」に合わせて軽いフィードバックを付与
  - UI: ボタン押下時に約120msで明度がスッと上がり、120msで元に戻る（アルファ/乗算ブレンドで実装）
  - Haptics: `UIImpactFeedbackGenerator(style: .light)` を基本。エラー時は `UINotificationFeedbackGenerator(.error)`
- サウンド素材（docs/material/keypadSounds/）
  - 数字キー: `k0.wav`〜`k9.wav`
  - 左補助（ポップ表示）: `kleft.wav`
  - 右削除（1文字削除）: `kright.wav`
  - 発信ボタン: 成功=`k0.wav` / 失敗=`ke.wav`
  - 設定の効果音ON/OFFに連動（AppSettings.soundsEnabled）

---

## フォント/見た目
- フォント: `BTTFTimeCircuitsAPDATEDAGAINIMSORRY`（端末に無い場合はアセット同梱、無ければ等幅フォントにフォールバック）
- 近似デザインでOK（グラデーション/白枠/影は省略可能）
- 矢印は静止画像で近似再現

---

## アクセシビリティ
- VoiceOver: 「年/月/日/時/分」と現在値・編集中フィールドを読上げ
- フォーカス移動時に視覚的強調（太い白枠）
- Dynamic Type は固定サイズでも可（画像優先のため）

---

## データ/実装メモ
- プリセット保存（SwiftData）: `QuickPreset`（id, daysOffset[Int], hour[Int], minute[Int], title[String], createdAt, updatedAt）
- 入力状態: 現在フィールド/桁数を保持。未確定離脱時は元値復帰
- フォント同梱場所: `Assets/Fonts/` を想定
- 右削除アイコン: バックスペース（例: SF Symbols `delete.left`）
- 左補助アイコン/下部ナビ: 類似の仮アイコンで配置（後日差し替え）

---

## フロー確認（この画面から）
1) 起動 → キーパッドで日時を入力（または小ウィンドウで選択）
2) 発信ボタン有効 → タップで接続音 → 録音画面へ
3) 録音 → プレビュー（詳細設定: タイトル/アフター/スヌーズ/アイコン）→ 保存 → 着信予定メールリスト

---

以上でキーパッド画面の仕様整理は完了です。実装に進みます。
