# アプリ制作 TODO 計画（flow ベース）

本計画は docs/specs/product.md に準拠し、提供いただく各UIイメージ画像に忠実に実装します。各画面は「画像確認タイム → 実装 → 動作確認 → 次画面へ」の順で進めます。既にXcodeで空プロジェクトが用意されているため、プロジェクト初期化作業は含めません。

---

## 原則 / 進め方
- 画像優先: 必ず実装前にUI画像を確認し、差異を潰してから着手
- 画面単位: 1画面ずつ完了させてから次へ（結合は逐次）
- 最低限MVP → 追加機能: product.md は最低限。MVP完了後に拡張タスクへ
- iOS前提: SwiftUI + AVFoundation + UserNotifications + SwiftData + PhotosUI（PHPicker）
- 注意: 擬似着信は2ボタン（応答/拒否）のみ。拒否時は自動スヌーズ再登録

---

## 事前共通タスク（軽量）
- 権限説明文の準備（Info.plist）
  - マイク、通知、カメラ（アイコン撮影）、写真（選択）
- SwiftData モデル雛形を追加（Message / AppSettings）
  - フィールド: product.md の `Message`/`AppSettings` に準拠
- ルーティングと下部5ボタンナビの土台（プレースホルダ）
  - アプリ設定 / 履歴リスト / キーパッド / 着信予定メールリスト（編集） / 留守電リスト
  - 初期表示はキーパッド

---

## フェーズA（キーパッド → 録音 → プレビュー → 保存）

1) キーパッド画面（起動直後）
- 画像確認タイム
- 実装 TODO
  - 電話キーパッド風UI（3×4、0-9/削除/OK）
  - 「0の左のボタン」押下で小ウィンドウ（クイック＋DatePicker）
  - 入力フォーマットとバリデーション（過去不可、上限期間）
- 動作確認
  - プリセット適用、DatePicker選択、OKで次へ遷移

2) 録音（接続中 → 録音中）
- 画像確認タイム
- 実装 TODO
  - 接続音（ミュート設定可）→ 自動録音開始
  - 波形/経過/残り/一時停止/停止、上限3分（AppSettingsで可変）
  - マイク権限誘導
- 動作確認
  - 3分上限・一時停止・再開、停止でプレビューへ

3) プレビュー（詳細設定）
- 画像確認タイム
- 実装 TODO
  - 再生/シーク、再録音、保存
  - 設定項目: タイトル（未入力時は「（日時）への電話」）
  - アフターメッセージ（応答直後に表示）
  - スヌーズ時間（デフォ10分）
  - アイコン設定（カメラ撮影 or 写真フォルダ選択）→ サムネ生成/保存
  - 保存時: `confirmedAt` を現在時刻でセット、SwiftDataへ保存、通知予約
- 動作確認
  - アイコン表示、保存成功 → 自動で「着信予定メールリスト」へ遷移

---

## フェーズB（リスト/ナビ/編集）

4) 着信予定メールリスト（編集）
- 画像確認タイム
- 実装 TODO
  - セル: アイコン / タイトル / 予定日時 / 小さく薄く「発信日時」
  - クイック操作（編集/削除/並び替え）
  - 削除は確認ダイアログ必須
  - リストの並び・フィルタ（今日/今週/すべて）
- 動作確認
  - 保存直後のデータが表示、編集・削除が反映

5) 下部ナビゲーション完成
- 画像確認タイム
- 実装 TODO
  - 5ボタン: アプリ設定 / 履歴リスト / キーパッド / 着信予定メールリスト / 留守電リスト
  - 初期表示はキーパッド、保存後に予定リストへ遷移
- 動作確認
  - 各タブ遷移、状態保持

6) 設定
- 画像確認タイム
- 実装 TODO
  - 効果音ON/OFF、既定スヌーズ、録音上限（3分デフォ）、アイコンバッジON/OFF
  - 権限状態表示（通知/マイク/カメラ/写真）
- 動作確認
  - 値の保存/反映（AppSettings in SwiftData）

---

## フェーズC（通知/擬似着信/再生/留守電/履歴）

7) 通知とディープリンク
- 画像確認タイム
- 実装 TODO
  - UNUserNotificationCenter 設定、通知許可リクエスト
  - 予約（`UNCalendarNotificationTrigger`）、payloadに `messageId`
  - 通知タップで擬似着信画面へ
- 動作確認
  - 近い時刻でテスト、タップ遷移

8) 擬似着信（応答/拒否のみ）
- 画像確認タイム
- 実装 TODO
  - 画面中央にアイコン、タイトル、予定時刻
  - 応答→再生画面へ、拒否→ `snoozeIntervalMin` 分で再通知自動登録
  - タイムアウト検知→ 留守電リスト投入、バッジ加算
- 動作確認
  - 応答/拒否/タイムアウトの各パス

9) 再生画面
- 画像確認タイム
- 実装 TODO
  - 再生/一時停止、完了で履歴へ
  - 再生開始時にアフターメッセージ表示（トースト/モーダル）
- 動作確認
  - 状態遷移: Playing → Played（履歴へ）

10) 留守電リスト
- 画像確認タイム
- 実装 TODO
  - 不達/未応答の受信箱表示
  - 1回再生で留守電リストから消え、履歴へ移動
  - バッジ数と連動（追加/消化で増減）
- 動作確認
  - 未読数、遷移、バッジ更新

11) 履歴リスト
- 画像確認タイム
- 実装 TODO
  - 過去の着信履歴表示、削除/一括整理
  - ブックマーク（固定）で削除対象外
- 動作確認
  - ブックマーク保持、削除/一括整理

---

## フェーズD（安定化/仕上げ）
- 画像最終照合（全画面）
- エラー/権限ハンドリング仕上げ（トースト文言、誘導）
- タイムゾーン/夏時間の表示確認
- 録音ファイル/アイコン画像のストレージ最終チェック（クリーンアップ規約）
- パフォーマンスとアクセシビリティ（VoiceOverラベル、Dynamic Type）
- アイコンバッジ挙動総合確認（留守電追加/消化）

---

## MVP完了の定義（DoD）
- 起動直後がキーパッドである
- プレビューでタイトル/アフターメッセージ/スヌーズ/アイコンを設定でき、保存で予定リストへ遷移
- 予定リストのセルにアイコン/タイトル/予定日時/発信日時が表示され、削除時は確認が出る
- 擬似着信は2ボタンのみ。拒否でスヌーズ再登録、タイムアウトで留守電入り
- 留守電リストは1回再生で履歴へ移動し、アイコンバッジと連動
- 設定でスヌーズ既定と録音上限（デフォ3分）が変更できる

---

## 拡張タスク（MVP後）
- 検索/タグ付け、並び替え高度化
- 共有/エクスポート（音声＋メタ）、バックアップ（iCloud Drive 等）
- アプリロック（Face ID/Passcode）
- 文字起こし（Speech）と要約
- スマート日時候補、ウィジェット、Siri/ショートカット
- UI微調整（アニメーション、触覚、ダークモード最適化）

---

## 画面ごとの確認タイム テンプレート
- 目的: 提供画像と差異がないか事前合意
- 確認観点
  - レイアウト/余白/フォント/色/アイコン位置
  - インタラクション（ボタン位置/タップ範囲/遷移アニメーション）
  - 文言（ラベル/ボタン/エラー）
- 確認完了後、実装着手

